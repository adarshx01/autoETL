<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoETL - Data Validation Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 40px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #495057;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 5px solid #667eea;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-running {
            background: #ffc107;
            color: #000;
        }
        
        .status-completed {
            background: #28a745;
            color: white;
        }
        
        .status-failed {
            background: #dc3545;
            color: white;
        }
        
        .results-container {
            margin-top: 30px;
        }
        
        .result-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .result-item h3 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .info-box h4 {
            color: #0066cc;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .job-history {
            margin-top: 30px;
        }
        
        .job-card {
            background: #fff;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .job-card:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ AutoETL</h1>
            <p>Enterprise Data Validation Agent - AI-Powered ETL Testing</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('stage1')">
                üìä Stage 1: ETL Execution
            </button>
            <button class="tab" onclick="showTab('stage2')">
                üß™ Stage 2: Validation
            </button>
            <button class="tab" onclick="showTab('combined')">
                ‚ö° Combined Workflow
            </button>
            <button class="tab" onclick="showTab('history')">
                üìú Job History
            </button>
            <button class="tab" onclick="showTab('metrics')">
                üìà Metrics
            </button>
        </div>
        
        <!-- STAGE 1: ETL Execution -->
        <div id="stage1" class="tab-content active">
            <h2>Stage 1: ETL Execution</h2>
            <p>Transform data from source database (DB1) to target database (DB2) using natural language business rules.</p>
            
            <div class="info-box">
                <h4>üí° How it works:</h4>
                <p>1. Select source and target tables<br>
                2. Describe your transformation in plain English<br>
                3. System executes ETL and transforms millions of records</p>
            </div>
            
            <form id="etlForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label for="etl_source_table">Source Table (DB1)</label>
                        <select id="etl_source_table" required>
                            <option value="">Select source table...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="etl_target_table">Target Table (DB2)</label>
                        <input type="text" id="etl_target_table" placeholder="e.g., customer_summary" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="etl_business_rule">Business Rule (Natural Language)</label>
                    <textarea id="etl_business_rule" placeholder="Example: Calculate total orders and revenue for each customer. Group by customer_id and include only active customers from the last 12 months." required></textarea>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label for="etl_batch_size">Batch Size</label>
                        <input type="number" id="etl_batch_size" value="10000" min="1000">
                    </div>
                    
                    <div class="form-group">
                        <label for="etl_use_dask">Use Dask (Distributed Processing)</label>
                        <select id="etl_use_dask">
                            <option value="true">Yes - For large datasets (millions of records)</option>
                            <option value="false">No - For smaller datasets</option>
                        </select>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="loadSourceTables()">
                        üîÑ Refresh Tables
                    </button>
                    <button type="submit" class="btn-primary">
                        üöÄ Execute ETL
                    </button>
                </div>
            </form>
            
            <div id="etlResults" class="results-container hidden">
                <!-- Results will be inserted here -->
            </div>
        </div>
        
        <!-- STAGE 2: Validation -->
        <div id="stage2" class="tab-content">
            <h2>Stage 2: Data Validation</h2>
            <p>Validate ETL transformations with comprehensive automated testing using AI-generated test scenarios.</p>
            
            <div class="info-box">
                <h4>üí° What gets validated:</h4>
                <p>‚Ä¢ Happy path scenarios<br>
                ‚Ä¢ Edge cases and boundary conditions<br>
                ‚Ä¢ Data quality checks (NULLs, duplicates)<br>
                ‚Ä¢ Statistical analysis and outlier detection<br>
                ‚Ä¢ Business rule compliance</p>
            </div>
            
            <form id="validationForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label for="val_source_table">Source Table (DB1)</label>
                        <select id="val_source_table" required>
                            <option value="">Select source table...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="val_target_table">Target Table (DB2)</label>
                        <select id="val_target_table" required>
                            <option value="">Select target table...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="val_etl_job_id">Link to ETL Job (Optional)</label>
                    <input type="text" id="val_etl_job_id" placeholder="Enter ETL Job ID to use its business rule">
                </div>
                
                <div class="form-group">
                    <label for="val_business_rule">Business Rule for Validation (Natural Language)</label>
                    <textarea id="val_business_rule" placeholder="Example: Verify that customer summary contains correct total orders and revenue. Each customer should have at least one order. No NULL values allowed in total_amount." required></textarea>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="loadTargetTables()">
                        üîÑ Refresh Tables
                    </button>
                    <button type="submit" class="btn-primary">
                        üß™ Start Validation
                    </button>
                </div>
            </form>
            
            <div id="validationResults" class="results-container hidden">
                <!-- Results will be inserted here -->
            </div>
        </div>
        
        <!-- Combined Workflow -->
        <div id="combined" class="tab-content">
            <h2>Combined Workflow: ETL + Validation</h2>
            <p>Execute both stages in sequence for end-to-end automated testing.</p>
            
            <form id="workflowForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label for="wf_source_table">Source Table (DB1)</label>
                        <select id="wf_source_table" required>
                            <option value="">Select source table...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="wf_target_table">Target Table (DB2)</label>
                        <input type="text" id="wf_target_table" placeholder="e.g., customer_summary" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="wf_business_rule">Business Rule (Natural Language)</label>
                    <textarea id="wf_business_rule" placeholder="Describe both transformation and validation requirements..." required></textarea>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="wf_run_etl" checked>
                            Run ETL (Stage 1)
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="wf_run_validation" checked>
                            Run Validation (Stage 2)
                        </label>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-primary">
                        ‚ö° Execute Complete Workflow
                    </button>
                </div>
            </form>
            
            <div id="workflowResults" class="results-container hidden">
                <!-- Results will be inserted here -->
            </div>
        </div>
        
        <!-- Job History -->
        <div id="history" class="tab-content">
            <h2>Job History</h2>
            <p>View all ETL and validation jobs</p>
            
            <div class="button-group">
                <button class="btn-primary" onclick="loadJobHistory('etl')">
                    üìä ETL Jobs
                </button>
                <button class="btn-primary" onclick="loadJobHistory('validation')">
                    üß™ Validation Jobs
                </button>
                <button class="btn-secondary" onclick="loadJobHistory()">
                    üìú All Jobs
                </button>
            </div>
            
            <div id="jobHistoryContainer" class="job-history">
                <!-- Job history will be loaded here -->
            </div>
        </div>
        
        <!-- Metrics -->
        <div id="metrics" class="tab-content">
            <h2>Performance Metrics</h2>
            <p>System performance and quality metrics</p>
            
            <button class="btn-primary" onclick="loadMetrics()">
                üîÑ Refresh Metrics
            </button>
            
            <div id="metricsContainer" class="metrics-grid">
                <!-- Metrics will be loaded here -->
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE_URL = 'http://localhost:8000';
        
        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data for certain tabs
            if (tabName === 'history') {
                loadJobHistory();
            } else if (tabName === 'metrics') {
                loadMetrics();
            }
        }
        
        // Load source tables
        async function loadSourceTables() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/databases/source/tables`);
                const data = await response.json();
                
                const selects = ['etl_source_table', 'val_source_table', 'wf_source_table'];
                selects.forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">Select source table...</option>';
                    data.tables.forEach(table => {
                        const option = document.createElement('option');
                        option.value = table;
                        option.textContent = table;
                        select.appendChild(option);
                    });
                });
            } catch (error) {
                alert('Failed to load tables: ' + error.message);
            }
        }
        
        // Load target tables
        async function loadTargetTables() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/databases/target/tables`);
                const data = await response.json();
                
                const select = document.getElementById('val_target_table');
                select.innerHTML = '<option value="">Select target table...</option>';
                data.tables.forEach(table => {
                    const option = document.createElement('option');
                    option.value = table;
                    option.textContent = table;
                    select.appendChild(option);
                });
            } catch (error) {
                alert('Failed to load target tables: ' + error.message);
            }
        }
        
        // ETL Form submission
        document.getElementById('etlForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                source_table: document.getElementById('etl_source_table').value,
                target_table: document.getElementById('etl_target_table').value,
                business_rule: document.getElementById('etl_business_rule').value,
                batch_size: parseInt(document.getElementById('etl_batch_size').value),
                use_dask: document.getElementById('etl_use_dask').value === 'true',
                user_id: 'web_user'
            };
            
            showLoading('etlResults');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/etl/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showETLResult(result);
                    pollJobStatus(result.job_id, 'etl');
                } else {
                    showError('etlResults', result.detail);
                }
            } catch (error) {
                showError('etlResults', error.message);
            }
        });
        
        // Validation Form submission
        document.getElementById('validationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                source_table: document.getElementById('val_source_table').value,
                target_table: document.getElementById('val_target_table').value,
                business_rule_text: document.getElementById('val_business_rule').value,
                etl_job_id: document.getElementById('val_etl_job_id').value || null,
                user_id: 'web_user'
            };
            
            showLoading('validationResults');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/validate/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showValidationResult(result);
                    pollJobStatus(result.job_id, 'validation');
                } else {
                    showError('validationResults', result.detail);
                }
            } catch (error) {
                showError('validationResults', error.message);
            }
        });
        
        // Workflow Form submission
        document.getElementById('workflowForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                source_table: document.getElementById('wf_source_table').value,
                target_table: document.getElementById('wf_target_table').value,
                business_rule: document.getElementById('wf_business_rule').value,
                run_etl: document.getElementById('wf_run_etl').checked,
                run_validation: document.getElementById('wf_run_validation').checked,
                user_id: 'web_user'
            };
            
            showLoading('workflowResults');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/workflow/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showWorkflowResult(result);
                    pollWorkflowStatus(result.workflow_id);
                } else {
                    showError('workflowResults', result.detail);
                }
            } catch (error) {
                showError('workflowResults', error.message);
            }
        });
        
        // Show loading spinner
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 20px;">Processing... Please wait</p>
                </div>
            `;
        }
        
        // Show error
        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="status-card" style="border-left-color: #dc3545;">
                    <h3>‚ùå Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // Show ETL result
        function showETLResult(result) {
            const container = document.getElementById('etlResults');
            container.innerHTML = `
                <div class="status-card">
                    <h3>ETL Job Created 
                        <span class="status-badge status-${result.status.toLowerCase()}">${result.status}</span>
                    </h3>
                    <p><strong>Job ID:</strong> ${result.job_id}</p>
                    <p><strong>Source:</strong> ${result.source_table} ‚Üí <strong>Target:</strong> ${result.target_table}</p>
                    <p><strong>Started:</strong> ${new Date(result.started_at).toLocaleString()}</p>
                    <p><strong>Estimated Time:</strong> ${result.estimated_completion_minutes} minutes</p>
                    <div id="etl_status_${result.job_id}"></div>
                </div>
            `;
        }
        
        // Show validation result
        function showValidationResult(result) {
            const container = document.getElementById('validationResults');
            container.innerHTML = `
                <div class="status-card">
                    <h3>Validation Job Created 
                        <span class="status-badge status-${result.status.toLowerCase()}">${result.status}</span>
                    </h3>
                    <p><strong>Job ID:</strong> ${result.job_id}</p>
                    <p><strong>Source:</strong> ${result.source_table} ‚Üí <strong>Target:</strong> ${result.target_table}</p>
                    <p><strong>Started:</strong> ${new Date(result.started_at).toLocaleString()}</p>
                    <div id="validation_status_${result.job_id}"></div>
                </div>
            `;
        }
        
        // Show workflow result
        function showWorkflowResult(result) {
            const container = document.getElementById('workflowResults');
            container.innerHTML = `
                <div class="status-card">
                    <h3>Workflow Created 
                        <span class="status-badge status-${result.status.toLowerCase()}">${result.status}</span>
                    </h3>
                    <p><strong>Workflow ID:</strong> ${result.workflow_id}</p>
                    <p><strong>Stages:</strong> ETL: ${result.stages.etl}, Validation: ${result.stages.validation}</p>
                    <p><strong>Started:</strong> ${new Date(result.started_at).toLocaleString()}</p>
                    <div id="workflow_status_${result.workflow_id}"></div>
                </div>
            `;
        }
        
        // Poll job status
        async function pollJobStatus(jobId, jobType) {
            const maxAttempts = 60; // 5 minutes
            let attempts = 0;
            
            const interval = setInterval(async () => {
                attempts++;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/api/${jobType}/status/${jobId}`);
                    const status = await response.json();
                    
                    updateJobStatus(status, jobType);
                    
                    if (status.status === 'COMPLETED' || status.status === 'FAILED' || attempts >= maxAttempts) {
                        clearInterval(interval);
                    }
                } catch (error) {
                    console.error('Failed to poll status:', error);
                }
            }, 5000); // Poll every 5 seconds
        }
        
        // Poll workflow status
        async function pollWorkflowStatus(workflowId) {
            const maxAttempts = 120; // 10 minutes
            let attempts = 0;
            
            const interval = setInterval(async () => {
                attempts++;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/api/workflow/status/${workflowId}`);
                    const status = await response.json();
                    
                    updateWorkflowStatus(status);
                    
                    if (status.status === 'COMPLETED' || status.status === 'FAILED' || attempts >= maxAttempts) {
                        clearInterval(interval);
                    }
                } catch (error) {
                    console.error('Failed to poll workflow status:', error);
                }
            }, 5000);
        }
        
        // Update job status display
        function updateJobStatus(status, jobType) {
            const statusDiv = document.getElementById(`${jobType}_status_${status.job_id}`);
            if (!statusDiv) return;
            
            let html = `
                <p><strong>Status:</strong> <span class="status-badge status-${status.status.toLowerCase()}">${status.status}</span></p>
            `;
            
            if (status.result_summary) {
                if (jobType === 'etl') {
                    html += `
                        <p><strong>Records Processed:</strong> ${status.result_summary.records_processed?.toLocaleString()}</p>
                        <p><strong>Duration:</strong> ${status.result_summary.duration_seconds?.toFixed(2)}s</p>
                        <p><strong>Throughput:</strong> ${status.result_summary.throughput?.toFixed(2)} records/sec</p>
                    `;
                } else if (jobType === 'validation') {
                    html += `
                        <p><strong>Total Tests:</strong> ${status.result_summary.total_tests}</p>
                        <p><strong>Passed:</strong> ${status.result_summary.passed}</p>
                        <p><strong>Failed:</strong> ${status.result_summary.failed}</p>
                        <p><strong>Pass Rate:</strong> ${status.result_summary.pass_rate?.toFixed(1)}%</p>
                        <button class="btn-primary" onclick="window.open('${API_BASE_URL}/api/reports/${status.job_id}', '_blank')">
                            üìä View Report
                        </button>
                    `;
                }
            }
            
            statusDiv.innerHTML = html;
        }
        
        // Update workflow status display
        function updateWorkflowStatus(status) {
            const statusDiv = document.getElementById(`workflow_status_${status.workflow_id}`);
            if (!statusDiv) return;
            
            let html = `
                <p><strong>Status:</strong> <span class="status-badge status-${status.status.toLowerCase()}">${status.status}</span></p>
                <p><strong>ETL Stage:</strong> ${status.stages.etl}</p>
                <p><strong>Validation Stage:</strong> ${status.stages.validation}</p>
            `;
            
            if (status.validation_job && status.validation_job.report_path) {
                html += `
                    <button class="btn-primary" onclick="window.open('${API_BASE_URL}/api/reports/${status.validation_job_id}', '_blank')">
                        üìä View Validation Report
                    </button>
                `;
            }
            
            statusDiv.innerHTML = html;
        }
        
        // Load job history
        async function loadJobHistory(jobType = null) {
            const container = document.getElementById('jobHistoryContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                let url = `${API_BASE_URL}/api/etl/jobs`;
                if (jobType === 'validation') {
                    url = `${API_BASE_URL}/api/validate/jobs`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.jobs.length === 0) {
                    container.innerHTML = '<p>No jobs found</p>';
                    return;
                }
                
                container.innerHTML = data.jobs.map(job => `
                    <div class="job-card">
                        <h3>${job.job_type.toUpperCase()} Job 
                            <span class="status-badge status-${job.status.toLowerCase()}">${job.status}</span>
                        </h3>
                        <p><strong>Job ID:</strong> ${job.job_id}</p>
                        <p><strong>Tables:</strong> ${job.source_table} ‚Üí ${job.target_table}</p>
                        <p><strong>Created:</strong> ${new Date(job.created_at).toLocaleString()}</p>
                        ${job.result_summary ? `
                            <p><strong>Summary:</strong> ${JSON.stringify(job.result_summary)}</p>
                        ` : ''}
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = `<p>Error loading jobs: ${error.message}</p>`;
            }
        }
        
        // Load metrics
        async function loadMetrics() {
            const container = document.getElementById('metricsContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const [etlResponse, valResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/metrics/etl`),
                    fetch(`${API_BASE_URL}/api/metrics/validation`)
                ]);
                
                const etlMetrics = await etlResponse.json();
                const valMetrics = await valResponse.json();
                
                container.innerHTML = `
                    <div class="metric-card">
                        <div class="metric-label">Total ETL Jobs</div>
                        <div class="metric-value">${etlMetrics.total_jobs || 0}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">ETL Success Rate</div>
                        <div class="metric-value">${etlMetrics.success_rate?.toFixed(1) || 0}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total Records Processed</div>
                        <div class="metric-value">${(etlMetrics.total_records_processed || 0).toLocaleString()}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Validation Pass Rate</div>
                        <div class="metric-value">${valMetrics.overall_pass_rate?.toFixed(1) || 0}%</div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `<p>Error loading metrics: ${error.message}</p>`;
            }
        }
        
        // Initialize on page load
        window.addEventListener('load', () => {
            loadSourceTables();
            loadTargetTables();
        });
    </script>
</body>
</html>
